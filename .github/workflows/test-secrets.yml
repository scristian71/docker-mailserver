name: 'Test Secrets Availability'

on:
  workflow_dispatch:  # Manual trigger for testing

permissions:
  contents: read

jobs:
  test-secrets:
    name: 'Test Secret Existence'
    runs-on: ubuntu-24.04
    steps:
      - name: 'Check Docker secrets'
        run: |
          echo "=== Docker Secrets ==="
          echo "DOCKER_USERNAME exists: ${{ secrets.DOCKER_USERNAME != '' }}"
          echo "DOCKER_USERNAME length: ${#DOCKER_USERNAME}"
          echo "DOCKER_PASSWORD exists: ${{ secrets.DOCKER_PASSWORD != '' }}"
          echo "DOCKER_PASSWORD length: ${#DOCKER_PASSWORD}"
          echo "DOCKER_REPOSITORY exists: ${{ secrets.DOCKER_REPOSITORY != '' }}"
          echo "DOCKER_REPOSITORY length: ${#DOCKER_REPOSITORY}"
          echo ""
          echo "=== GitHub Secrets ==="
          echo "GHCR_REPOSITORY exists: ${{ secrets.GHCR_REPOSITORY != '' }}"
          echo "GHCR_REPOSITORY length: ${#GHCR_REPOSITORY}"
          echo "GITHUB_TOKEN exists: ${{ secrets.GITHUB_TOKEN != '' }}"
          echo ""
          echo "=== Context Info ==="
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
        env:
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          DOCKER_REPOSITORY: ${{ secrets.DOCKER_REPOSITORY }}
          GHCR_REPOSITORY: ${{ secrets.GHCR_REPOSITORY }}

      - name: 'Fail if required secrets missing'
        run: |
          if [ -z "$DOCKER_USERNAME" ] || [ -z "$DOCKER_PASSWORD" ]; then
            echo "ERROR: Required Docker secrets are missing!"
            exit 1
          fi
        env:
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
